function cart(){var t=setInterval(function(){if(isTovarsFromDBLoaded()&&$(".t706__cartwin-content").length&&$('.t706 [name="otkuda-uznal-o-nas"]').length){if(!cartEnabled[site])return $(".t706").remove(),void clearInterval(t);setTimeout(function(){cartFunctions()},1e3),clearInterval(t)}},50)}function cartFunctions(){cartIconUponHeader(),cartOpen(),cartClose(),cartInputContainersClasses(),cartPromocode(),cartDelivery(),cartDeliveryZazhopinsk(),cartZakazchikNoTelegramNick(),cartZakazchikPoluchatel(),cartFormValidationTexts(),cartAdresPoluchatelya(),cartHerZnaetPoluchatelya(),cartCountItems(),cartPlusMinusItems(),cartDopsReminder(),cartPreventCloseOnOverlayClick(),cartErrorsMessageOnClick(),cartImportantFields(),cartRequiredFields(),cartYaCounterId(),cartSetCookies(),cartUseCookies(),cartHideOtkudaUznal(),cartHtmlEntities(),cartLovixlube(),cartSuccess()}function cartDynamicFunctions(){cartProductOptionsInOneLine(),cartOtsluniavit(),cartOnlyOneFromVitrina(),cartPayedDeliveryForOnlyDops(),cartDonat(),cartPromocodeTovars(),cartShow()}function cartOpen(){$("body").on("click",".t706__carticon-wrapper,.t-store__prod-popup__btn",function(){setTimeout(function(){cartDynamicFunctions()},250)})}function cartClose(){$("body").on("click",".t706__close",function(){cartHide()})}function cartShow(){$(".t706__cartwin-content").fadeIn()}function cartHide(){$(".t706__cartwin-content").hide()}function cartInputContainersClasses(){$(".t706 .t-input-group").find("input,textarea,select").each(function(){var t=$(this).attr("name");$(this).parents(".t-input-group").attr("id",t.replace("tildaspec-mask-",""))})}function cartCountItems(){var t;setInterval(function(){var e=$(".t706__cartwin-products").children();t!=e.length&&(cartDynamicFunctions(),t=e.length)},1)}function cartPlusMinusItems(){$(".t706").on("click",".t706__product-plus,.t706__product-minus",function(){cartDynamicFunctions()})}function cartDopsReminder(){var t={"2steblya":'хош добавить <a href="/catalog?tfc_quantity[643365612]=y&tfc_storepartuid[643365612]=%D0%9F%D0%9E%D0%94%D0%90%D0%A0+%D0%9E%D0%A7%D0%9A%D0%98&tfc_div=:::">подар очек</a> к букету? а што насчёт <a href="https://2steblya.ru/catalog?tfc_quantity[643365612]=y&tfc_storepartuid[643365612]=%D0%92%D0%90%D0%97%D0%AB&tfc_div=:::">вазы</a>?',staytrueflowers:""};"2steblya"==site&&$(".t706__cartwin-products").after('<div class="t706__cartwin-dopsReminder">'+t[site]+"</div>")}function cartDelivery(){function t(){function t(){o.today=new Date,o["today-0"]=new Date,o["today-0"].setHours(0,0,0,0),o["tomorrow-0"]=new Date,o["tomorrow-0"].setDate(o["today-0"].getDate()+1),o["tomorrow-0"].setHours(0,0,0,0)}t(),setInterval(function(){t()},6e4)}function e(){setInterval(function(){if(c.val()&&"____-__-__"!=c.val()&&c.val()!=o["selected-yyyy"]+"-"+(o["selected-m"]<10?"0":"")+o["selected-m"]+"-"+(o["selected-d"]<10?"0":"")+o["selected-d"]){var t=c.val().split("-");o["selected-0"]=new Date(+t[0],t[1]-1,+t[2]),o["selected-d"]=parseInt(t[2].replace(/^0/,"")),o["selected-m"]=parseInt(t[1].replace(/^0/,"")),o["selected-yyyy"]=parseInt(t[0])}},50)}function a(){function t(){i.find(".t_datepicker__selected-day").removeClass("t_datepicker__selected-day"),c.val()&&i.find('[data-picker="'+o["selected-yyyy"]+"-"+o["selected-m"]+"-"+o["selected-d"]+'"]').addClass("t_datepicker__selected-day")}function e(){$(".t706 .t_datepicker__day-cell").each(function(){var t=$(this),e=t.attr("data-picker").match(/\d{4}\-(\d{1,})\-(\d{1,})/),r=t.is(".t_datepicker__next-month")||t.is(".t_datepicker__previous-month")||t.is(".t_datepicker__day-cell--disabled");$.each(specialDatesList,function(t,n){n.d==e[2]&&n.m==e[1]&&a(n,r)})})}function a(t,e){function a(e){var a=getTovarInCartId(e);return t[site].exclude.includes(a)?a:getTovarInCartPrice(e)>=t[site].minPrice&&a}function r(t){return!isTovarsFromDBEmpty("dopnik")&&tovarsFromDB.dopnik.includes(t)}var n=!1,o=!1,c=[],s=$(".t706__product");if(s.length&&(s.each(function(){var t=a($(this));t&&(o=!0),c.push(t)}),o&&(n=!0,s.length>1&&s.each(function(){var t=getTovarInCartId($(this));c.includes(t)||r(t)||(n=!1)}),!n&&t[site].minPrice))){var l=t[site].minPrice.toString().replace(/0{3}$/,"к"),d="";d+=t[site].exclude.length?"только товары из праздничной коллекции и ":"",d+="товары от "+l,d=$('<div class="t_datepicker__specialDate" title="'+d+'">от<br>'+l+"</div>"),e&&d.css("opacity",.4),i.find('[data-picker$="-'+t.m+"-"+t.d+'"]').hide().after(d)}}function r(){function t(){var t=Cookies.get("buytoday");if(!t)return!1;var e=new Date,a=String(e.getDate()).padStart(2,"0"),r=String(e.getMonth()+1).padStart(2,"0"),n=e.getFullYear(),i=CryptoJS.MD5(a+""+r+n).toString();return t==i}if(!isTovarsFromDBEmpty("allowed_today")){var e=!1,a=$(".t706__product");a.length&&(a.each(function(){if(e=!!tovarsFromDB.allowed_today.includes(getTovarInCartId($(this))),!e)return!1}),t()&&(e=!0),e&&$(".t706 .t_datepicker__today").removeClass("t_datepicker__day-cell--disabled"))}}function n(){if(!isTovarsFromDBEmpty("vitrina")){var t=!1,e=$(".t706__product");if(e.length&&(e.each(function(){if(t=!!tovarsFromDB.vitrina.includes(getTovarInCartId($(this))),!t)return!1}),t)){var a={"2steblya":"с ветрины только щас или завтро",staytrueflowers:"с витрины только на сегодня или на завтра"};$(".t706 .t_datepicker__day-cell").addClass("t_datepicker__day-cell--disabled"),$(".t706 .t_datepicker__today").add($(".t706 .t_datepicker__today").next()).removeClass("t_datepicker__day-cell--disabled").attr("title",a[site])}}}var i,s=!1;setInterval(function(){if(i=$(".t706 .t_datepicker__inner"),i.length)return i.is(":hidden")?(c.attr("disabled",!1),void(s=!1)):void(s||(t(),e(),r(),n(),c.attr("disabled",!0),s=!0))},50),$("body").on("click",".t706 .t_datepicker__day-cell:not(.t_datepicker__past)",function(){setTimeout(function(){c.change()},100)}),$("body").on("click",".t706 .t_datepicker__arrow",function(){s=!1}),$("body").on("change",".t706 .t_datepicker__header select",function(){s=!1}),$("body").on("click",".t706__close-button,.t706__product-del",function(){c.val("")})}function r(){function t(){o.today.getHours()>=18&&a(1)}function e(){if(!isTovarsFromDBEmpty("allowed_today")){var t=o.today.getHours(),e=$(".t706__product"),r=6;for(e.each(function(){var t=getTovarInCartId($(this));tovarsFromDB.allowed_today.includes(t)&&(isTovarsFromDBEmpty("hours_to_produce")||Object.keys(tovarsFromDB.hours_to_produce).includes(t)&&(r-=tovarsFromDB.hours_to_produce[t]))}),i=1;i<=4;i++)t>=r+4*i&&a(i);a(1)}}function a(t){t--,$(s[t]).attr("disabled",!0).parent().css("opacity",.3),$(s[t]).is(":checked")&&$(s[t+1]).trigger("click")}setInterval(function(){$("#dostavka-interval").toggle(!!c.val())},100),$("body").on("change",s.selector+","+c.selector,function(){for(var a=0;a<s.length;a++)$(s[a]).attr("disabled",!1).parent().css("opacity",1);o["selected-0"]&&(o["selected-0"].toDateString()==o["tomorrow-0"].toDateString()&&t(),o["selected-0"].toDateString()==o["today-0"].toDateString()&&e())})}function n(){var t={"2steblya":["телегу","https://t.me/dva_steblya"],staytrueflowers:["телеграм","https://t.me/staytrueflowers"]},e=$("#dostavka-date .t-input-subtitle"),a=e.text().replace(t[site][0],'<a href="'+t[site][1]+'">'+t[site][0]+"</a>");e.html(a)}var o={},c=$('.t706 [name="dostavka-date"]'),s=$('.t706 [name="dostavka-interval"]');c.prop("readonly",!0),t(),e(),a(),r(),n()}function cartDeliveryZazhopinsk(){$("#adres-zazhopinsk").wrap('<div id="adres-zazhopinsk__cont"></div>'),$("#adres-zazhopinsk input").on("change",function(){deliveryPriceInterval(!$(this).is(":checked"))})}function cartOtsluniavit(){"2steblya"==site&&$(".t706__cartwin-prodamount-label").text("нужно отслюнявить ")}function cartDonat(){function t(){$("#florist-comment > label").text("восторги и благодарности"),$('[name="florist-comment"]').attr("placeholder","мы готовы впитывать")}function e(){if(!$('[name="dostavka-date"]').val()){var t=new Date,e={d:t.getDate()+1,m:t.getMonth()+1,y:t.getFullYear()};e.d<10&&(e.d="0"+e.d),e.m<10&&(e.m="0"+e.m),$('[name="dostavka-date"]').val(e.y+"-"+e.m+"-"+e.d)}}if("2steblya"==site){$(".t706__cartwin-content").removeClass("donat");var a=$(".t706__product");if(a.length&&!(a.length>1)){var r={"2steblya":857613433221,staytrueflowers:""};getTovarInCartId(a.eq(0))==r[site]&&($(".t706__cartwin-content").addClass("donat"),cartIncompleteRemoveRequired(),t(),e())}}}function cartZakazchikNoTelegramNick(){var t=$('[name="messenger-zakazchika"]'),e=$('<div id="messenger-zakazchika-no-telegram">нет никнейма</div>');e.insertBefore(t),e.on("click",e.selector,function(){t.val($('[name="name-zakazchika"]').val()||"нет никнейма")})}function cartZakazchikPoluchatel(){var t=$('.t706 [name="name-poluchatelya"]'),e=$('.t706 [name="phone-poluchatelya"]');$("#name-poluchatelya,#phone-poluchatelya,#phone-poluchatelya + div").wrapAll("<div />").wrapAll('<div id="poluchatelData" />');var a,r=$('.t706 [name="name-zakazchika"]'),n=$('.t706 [name="phone-zakazchika"]'),i=['<div class="t-input-group t-input-group_cb unimportant">','<label class="t-checkbox__control t-text t-text_xs">','<input type="checkbox" class="t-checkbox js-tilda-rule">','<div class="t-checkbox__indicator"></div>',"получать буду я","</label>","</div>"],o=$(i.join(""));o.insertBefore("#poluchatelData"),o.on("change","input",function(){$("#poluchatelData").toggle(!$(this).is(":checked")),$(this).is(":checked")?a=setInterval(function(){t.val(r.val()),e.val(n.val())},50):(t.val(""),e.val(""),clearInterval(a))})}function cartImportantFields(){if(!cartExpanded[site]){var t={"2steblya":["чтобы не мурыжить тебя в телеге, лучше","заполнить всю инфу сразу"],staytrueflowers:["чтобы нам не пришлось потревожить вас в телеграме, лучше","указать дополнительные данные"]},e=$("#dostavka-interval");e.nextAll().not(":last").hide().addClass("unimportantField");var a=['<div class="t-input-group t-input-group_cb" id="unimportantTrigger">','<div class="t-input-title t-descr t-descr_md">'+t[site][0]+"</div>",'<label class="t-checkbox__control t-text t-text_xs" style="padding:10px 0">','<input type="checkbox" class="t-checkbox js-tilda-rule">','<div class="t-checkbox__indicator"></div>',t[site][1],"</label>","</div>"],r=$(a.join(""));r.insertAfter(e),r.on("change","input",function(){cartIncompleteRemoveRequired(),r.nextAll().not(":last").toggle($(this).is(":checked")),$("#unimportantTrigger").remove()})}}function cartHtmlEntities(){var t=$(".t706 .unimportantField textarea, .t706 .unimportantField input");t.on("blur",function(){$(this).val($(this).val().replaceAll("@","&#64;"))})}function cartLovixlube(){$('#lovixlube[data-input-lid="1688065007506"] .t-input-block').append('<a href="/14feb" />')}function cartPayedDeliveryForOnlyDops(){if(!isTovarsFromDBEmpty("dopnik")){var t=!1,e=$(".t706__product");if(e.length){if(e.each(function(){if(t=!!tovarsFromDB.dopnik.includes(getTovarInCartId($(this))),!t)return!1}),!t)return $("#adres-zazhopinsk input").prop("checked",!1),$("#adres-zazhopinsk").hide(),void deliveryPriceInterval(!1);$("#adres-zazhopinsk").show(),deliveryPriceInterval(!0)}}}function deliveryPriceInterval(t){$("#dostavka-interval label:not(:last) input").attr("data-delivery-price",t?$('.t706 [name="dostavka-price"]').val():"");var e=$("input[data-delivery-price]:checked");$("input[data-delivery-price]:last").trigger("click"),e.trigger("click")}function cartRequiredFields(){if(cartExpanded[site]){var t=['.t706 [name="dostavka-interval"]','.t706 [name="name-poluchatelya"]','.t706 [name="phone-poluchatelya"]','.t706 [name="adres-poluchatelya-street"]','.t706 [name="adres-poluchatelya-dom"]'];$(t.join(",")).attr("data-tilda-req",1),cartIncompleteRemoveRequired()}}function cartFormValidationTexts(){var t={"2steblya":["ну не-е-е-е...","скинь телефончик, а?","а куда фотку букета выслать?","ты календарь... переверни...","а вдруг разбудим?"],staytrueflowers:["пожалуйста, укажите ваше имя","пожалуйста, укажите ваш номер телефона","пожалуйста, укажите ваш ник в телеграм","пожалуйста, укажите дату доставки","пожалуйста, укажите интервал доставки"]};formValidationTexts($(".t706__orderform"),t[site])}function cartAdresPoluchatelya(){function t(){$.each(a,function(t,e){r[e]=$('.t706 [name="adres-poluchatelya-'+e+'"]'),["city","street"].includes(e)||n.push("#adres-poluchatelya-"+e)})}function e(){$(n.join(",")).wrapAll('<div id="adresDataSmall" />').wrapAll("<div />"),$("#adres-poluchatelya-street,#adresDataSmall,#courier-comment").wrapAll("<div />").wrapAll('<div id="adresData" />')}var a=["city","street","dom","kvartira","korpus","stroenie","podezd","etazh","domofon"],r={},n=[];t(),e()}function cartHerZnaetPoluchatelya(){var t=$('.t706 [name="uznat-adres-u-poluchatelya"]');cartExpanded[site]?$("#uznat-adres-u-poluchatelya").remove():t.on("change",function(){$("#adresData").toggle(!$(this).is(":checked")),$('.t706 [name="courier-comment"]').val("").trigger("change"),$(".t706 .adresInput").each(function(){$(this).val("")})})}function cartProductOptionsInOneLine(){var t=$(".t706__product-title__option div");t.each(function(){var t=$(this).text().split(/\s*:\s*/);switch(t[0]){case"накинуть косарь":case"накинуть пятихатку":case"накинуть сотен":case"эвкалипт ннада":case"добавить 1000":case"добавить 500":case"добавить 100":$(this).hide();break;case"выебри карточку":case"карточка":t[1]=t[1].replace("со своим","с вашим")}$(this).text(t[1])})}function cartPreventCloseOnOverlayClick(){var t=$(".t706__cartwin"),e=$('<div class="t706__cartwin-overlay"></div>');t.append(e),t.on("scroll",function(){e.css("top",$(this).scrollTop()+"px")})}function cartErrorsMessageOnClick(){var t,e,a=$(".t706__cartwin .t-submit"),r=a.text();a.on("click",function(){clearTimeout(t),clearTimeout(e),a.text("..."),t=setTimeout(function(){var t=$(".t706 .js-error-control-box"),n=[];if($.each(t,function(){var t=$(this).find(".t-input-title").text().trim();t&&n.push(t)}),n.length||1!=t.length||cartExpanded[site]){var i,o={"2steblya":"ЧТО-ТО НЕ ТОГО. ПЕРЕПРОВЕРЬ!",staytrueflowers:"ФОРМА СОДЕРЖИТ ОШИБКИ"};cartExpanded[site]?(i=3e3,a.text(o[site])):(i=6e3,a.html(o[site]+'<br><span class="errorsDescription">'+n.join(" / ")+"</span>")),e=setTimeout(function(){a.text(r)},i)}else cartFormIncomplete(),a.text(r)},400)})}function cartFormIncomplete(){cartIncompleteRemoveRequired();var t=$('[data-tooltip-hook="#popup:cartIncomplete"]');t.show().animate({opacity:1},"fast",function(){window.dispatchEvent(new Event("resize"))}),t.find(".t390__btn-wrapper a:nth-child(2)").on("click",function(t){t.preventDefault(),$(".t706__cartwin .t-submit").trigger("click")}),t.find(".t390__btn-wrapper a:nth-child(1)").on("click",function(e){e.preventDefault(),$("#unimportantTrigger input").trigger("click"),$("#unimportantTrigger").remove(),t.find(".t-popup__close").trigger("click")})}function cartIncompleteRemoveRequired(){var t={"2steblya":"1675967313188",staytrueflowers:""};$('.t706 [data-input-lid="'+t[site]+'"] input').removeAttr("data-tilda-req")}function cartYaCounterId(){setTimeout(function(){var t;switch(site){case"2steblya":"undefined"!=typeof yaCounter89315640&&(t=yaCounter89315640);break;case"staytrueflowers":"undefined"!=typeof yaCounter85909890&&(t=yaCounter85909890)}t&&$('.t706 [name="ya-client-id"]').val(t.getClientID())},3e3)}function cartIconUponHeader(){if("2steblya"==site&&!(document.location.href.indexOf("tproduct")>-1)&&$(window).width()>980&&$(window).width()<1370){var t=$(".t706__carticon"),e=110;setInterval(function(){t.toggleClass("uponHeader",$(window).scrollTop()<=e)},50)}}function cartOnlyOneFromVitrina(){if(tovarsFromDB.vitrina.length){var t=$(".t706__product");t.length&&t.each(function(){var t=getTovarInCartId($(this));(isTovarsFromDBEmpty("vitrina")||tovarsFromDB.vitrina.includes(t))&&t!=nitakoi[site]&&$(this).children(".t706__product-plusminus").empty()})}}function cartPromocodeTovars(){if("all"==promocodeType[site])$("#promocode > div").show();else{var t=!1,e=$(".t706__product");e.each(function(){if(promocodeTovars[site].includes(getTovarInCartId($(this))))return t=!0,!1}),$("#promocode > div").toggle(t)}}function cartPromocode(){var t=$(".t-inputpromocode__wrapper");t.parents(".t-input-group").wrap('<div id="promocode"></div>'),$(".t-form__submit button").on("click",function(){setTimeout(function(){if(!t.find(".t-text").length&&t.siblings(".t-input-error").length&&"2steblya"==site){if(!t.find("input").val())return;t.siblings(".t-input-error").text("применяй или удаляй").show()}},500)}),$(".t706 .t-inputpromocode__btn").on("click",function(){setTimeout(function(){$(".t706 .t-inputpromocode__btn").length||"2steblya"==site&&t.find(".t-text").addClass("showed").html($(".t-inputpromocode__wrapper .t-text").html().replace("Ваша","твоя").replace("Промокод","промокод").replace(".",""))},500)})}function cartSetCookies(){function t(t,e){var a=[];$.each(e,function(t,e){a.push("#"+e+" input")}),$("body").on("change",a.join(),function(){if($(this).val()){var r={};$.each(e,function(t,e){r[e]=$(a[t]).val()}),Cookies.set(t,JSON.stringify(r),{expires:365})}})}t("zakazchik",["name-zakazchika","phone-zakazchika","messenger-zakazchika"]),t("adres-poluchatelya",["adres-poluchatelya-street","adres-poluchatelya-dom","adres-poluchatelya-kvartira","adres-poluchatelya-korpus","adres-poluchatelya-stroenie","adres-poluchatelya-podezd","adres-poluchatelya-etazh","adres-poluchatelya-domofon","courier-comment","adres-poluchatelya-city"])}function cartUseCookies(){function t(t,e,a,r){var n=Cookies.get(t);if(n){n=JSON.parse(n);for(var i=Object.values(n),o=0;o<a.length;o++)if(!i[a[o]])return;var c=$('<a class="cartUseCookieBtn">'+r+"</a>");$("#"+e[0]).append(c),c.on("click",function(t){t.preventDefault(),$(this).hide(),$.each(e,function(t,a){$("#"+e[t]+" input").val(i[t]).change()})})}}t("zakazchik",["name-zakazchika","phone-zakazchika","messenger-zakazchika"],[0,1],"вспомнить меня"),t("adres-poluchatelya",["adres-poluchatelya-street","adres-poluchatelya-dom","adres-poluchatelya-kvartira","adres-poluchatelya-korpus","adres-poluchatelya-stroenie","adres-poluchatelya-podezd","adres-poluchatelya-etazh","adres-poluchatelya-domofon","courier-comment","adres-poluchatelya-city"],[0,1],"как в прошлый раз")}function cartHideOtkudaUznal(){var t=Cookies.get("zakazchik");t&&$("#otkuda-uznal-o-nas").remove()}function cartSuccess(){var t=$(".t706 .js-successbox"),e={"2steblya":'заказ оформлен успешно, но похоже Юкасса тупит и не хочет, штоб твои денюжки потекли к нам рекой<br><br>напиши нам в <a href="https://t.me/dva_steblya">телегу</a>, расскажи, что вот такая оказия случилась, и мы скинем тебе новую нормальную ссыклу на оплат очку',staytrueflowers:'Ваш заказ оформлен, но мы не смогли перенаправить вас на оплату заказа в Юкассе.<br><br>Напишите нам в <a href="https://t.me/staytrueflowers">телеграм</a>, и мы вышлем вам новую рабочую ссылку на оплату.'};t.addClass("hidden").attr("data-success-message",e[site]),$(".t706 form").on("tildaform:aftersuccess",function(){setTimeout(function(){t.removeClass("hidden")},3e3)})}function getTovarInCartId(t){return parseInt(t.find(".t706__product-title a").attr("href").match(/\d{12}/))}function getTovarInCartPrice(t){return parseInt(t.find(".t706__cartwin-prodamount-price").text().replace(/[^\d]/,""))}var promocodeApplied=[];