function product(){var t=setInterval(function(){if(tovarsFromDBReady)if(window.location.pathname.includes("/tproduct/")){productLogoInHeader();var o=$(".js-store-product:not(.loaded)");if(!o)return;if(!$(".t-slds__item-loaded").length)return;setTimeout(function(){productTovarFunctions(o)},1e3),clearInterval(t)}else{var e=$(".js-store");if(!e.length)return;e.each(function(){var t=$(this);productCatalogFunctions(t),setTimeout(function(){$.each(e,function(){var t=$(this),o=t.find(".js-store-grid-cont .js-product");o.length&&(o.each(function(){productCatalogTovarFunctions($(this),t)}),window.dispatchEvent(new Event("resize")))})},1e3)}),clearInterval(t)}},50)}function productTovarFunctions(t){productReplaceCardImgWithText(t),productVyebriKartochku(t),productOptionsReadMore(t),productHtmlInDescription(t),productHideEmptyText(t),productAddAdditionalText(t),productFlowersSeason(t),productEvkalipt(t),productMono(t),productPodpiska(t),productCharcs(t),productBlackFriday(t),productSoldOut(t),produnctNotAllowed(t),productButtonDonat(t),productButtonYandexMetrika(t),productOnPhoto(t),productNavigateToOptionPhoto(t),productCartDisabled(t),productHideDisabledFormatOption(t),productShow(t)}function productCatalogTovarFunctions(t,o){productPrices(t,o),productReplaceCardImgWithText(t,o),productBlackFriday(t),productSoldOut(t,o),produnctNotAllowed(t,o),productPlashka(t),productBomjPlashka(t,o),productVideoPreview(t,o),productHideVitrinaDuplicate(t,o),productsToHide(t,o),productShow(t)}function productCatalogFunctions(t){productPopupOpen(t),productPopupClose(),productCatalogMenu(t),productCatalogMutationObserver(t)}function productIsPopup(){return!($("#allrecords > *").length<=4)}function productPopupOpen(t){var o=setInterval(function(){function e(t,o){t.length&&setTimeout(function(){productTovarFunctions(r)},1e3)}var r=t.find(".t-popup .js-product:not(.loaded)");if(r.length){var a=new MutationObserver(e);a.observe(r.get(0),{attributes:!0,attributeFilter:["data-product-gen-uid"],attributeOldValue:!0,childList:!1,subtree:!1}),clearInterval(o)}},50)}function productPopupClose(){$("body").on("click",".t-popup__close,.t-store__prod-popup__close-txt-wr,.t-store__prod-popup__btn",function(){var t=$(this).parents(".t-popup").find(".js-product");productHide(t)})}function productShow(t){t.addClass("loaded"),t.children().animate({opacity:1},250)}function productHide(t){t.removeClass("loaded multiplePrices bomj noCard"),setTimeout(function(){t.children().css("opacity",0)},300)}function productCatalogMenu(t){setTimeout(function(){var o=t.find(".js-store-parts-switcher");o.length},1e3)}function productCatalogMutationObserver(t){function o(o,e){if(o.length){var r=t.find(".js-store-grid-cont .js-product:not(.loaded)");r.length&&setTimeout(function(){r.each(function(){productCatalogTovarFunctions($(this),t)}),window.dispatchEvent(new Event("resize")),"function"==typeof reorderTovarsByCardWrapper&&reorderTovarsByCardWrapper()},1e3)}}var e=new MutationObserver(o);e.observe(t.children(".js-store-grid-cont").get(0),{attributes:!1,childList:!0,subtree:!1})}function productHideVitrinaDuplicate(t,o){isVitrina(o)||$.each(tovarsFromDB.vitrina,function(o,e){getTovarId(t)==e&&t.hide()})}function productPrices(t,o){function e(){tovarsFromDB.fixed_price.includes(getTovarId(t))||t.find('[data-edition-option-id="'+productFormat[site]+'"] select option').length<2||t.addClass("multiplePrices")}function r(){var o=!1;if($.each(productPriceLevels[site],function(e,r){e>=minPrice[site]||(o=!0,t.removeClass("bomj"),$.each(r,function(o,e){t.find('[data-edition-option-id="'+productFormat[site]+'"] select option[value="'+e+'"]').remove()}))}),o){var e=t.find('[data-edition-option-id="'+productFormat[site]+'"] select option').length;e||t.hide(),1==e&&t.removeClass("multiplePrices"),getTovarPrice(t)<minPrice[site]&&t.find(".js-product-price").text(minPrice[site].toString().replace(/(\d{3})$/," $1"))}}e(),isVitrina(o)||r()}function productCartDisabled(t){if(!cartEnabled[site]){var o={"2steblya":["а как купить?",'сорян, мы зашиваемся и пока прием заказов заказан. но если у вас очень важное дело, то напишите нам в <a href="https://t.me/dva_steblya" target="blank">телегу</a>, че-нить придумаем<'],"2steblya_white":["А как купить?",'К сожалению, в данный момент прием заказов закрыт. но ты всегда можешь <a href="https://t.me/dva_steblya">написать нам</a>, и мы обязательно постараемся тебе помочь.'],gvozdisco:["А как купить?",'К сожалению, в данный момент прием заказов закрыт. но ты всегда можешь <a href="https://t.me/dva_steblya">написать нам</a>, и мы обязательно постараемся тебе помочь.'],dorogobogato:["А как купить?",'К сожалению, в данный момент прием заказов закрыт. но ты всегда можешь <a href="https://t.me/dva_steblya">написать нам</a>, и мы обязательно постараемся тебе помочь.'],staytrueflowers:["А как купить?",'К сожалению, в данный момент прием заказов закрыт. Но вы всегда можете <a href="https://t.me/staytrueflowers">написать нам</a>, и мы обязательно постараемся вам помочь.']},e=['<p class="t-btn">'+o[site][0]+"</p>",'<p class="t-text">'+o[site][1]+"/p>"],r=$('<div class="cartDisabled t-text"></div>');r.html(e.join("")),t.find(".js-product-controls-wrapper").hide().after(r),t.find(".js-store-buttons-wrapper").remove()}}function productPlashka(t){var o=t.find(".t-store__card__mark-wrapper");if(!o.length){var e=[],r={random_sostav:{"2steblya":"букет, чтоб не париться с выбором","2steblya_white":"состав на вкус флориста",staytruefloers:"состав на вкус флориста"},select_gamma:{"2steblya":"можно выбрать гамму","2steblya_white":"можно выбрать гамму",staytruefloers:"можно выбрать гамму"},select_color:{"2steblya":"можно выбрать цвет","2steblya_white":"можно выбрать цвет",staytruefloers:"можно выбрать цвет"}};for(var a in r)r.hasOwnProperty(a)&&tovarsFromDB[a].includes(getTovarId(t))&&e.push(r[a][site]);e.length&&(o=$('<div class="t-store__card__mark-wrapper"><div class="t-store__card__mark">'+e.join(", ")+"</div></div>"))}o.length&&o.appendTo(t.find(".t-store__card__bgimg"))}function productBomjPlashka(t,o){if(("2steblya"==site||"2steblya_white"==site)&&!(getTovarPrice(t)>Object.keys(productPriceLevels[site])[0]||tovarsFromDB[888].includes(getTovarId(t)))){t.addClass("bomj");var e={"2steblya":"бомжетный","2steblya_white":"бюджетный",gvozdisco:"бюджетный",dorogobogato:"бюджетный",staytrueflowers:"бюджетный"},r=$('<div class="bomjPlashka">'+e[site]+"</div>");t.find(o?".js-product-img":".t-slds").append(r),o||setInterval(function(){r.toggle(!$('.t-slds__item[data-slide-index="2"]').is(".t-slds__item_active"))},100)}}function productVideoPreview(t,o){if(tovarsFromDB.video_preview[getTovarId(t)]){var e=$(`\n\t\t<div class="videoPreview_cont">\n\t\t\t<video autoplay muted loop>\n\t\t\t\t<source src="https://php.2steblya.ru/utils/video_preview/${site}/${tovarsFromDB.video_preview[getTovarId(t)]}.mp4" type="video/mp4">\n\t\t\t\tYour browser does not support HTML5 video.\n\t\t\t</video>\n\t\t</div>\n\t`);t.find(".t-store__card__bgimg_second").empty().append(e)}}function productButtonDonat(t){tovarsFromDB[1111].includes(getTovarId(t))&&$(".js-store-prod-popup-buy-btn-txt").text("ЗАДОНАТИТЬ!")}function productButtonYandexMetrika(t){$('a[href="#order"]').on("click",function(){data={id:getTovarSku(t),name:getTovarTitle(t),price:getTovarPrice(t),format:t.find(".js-product-edition-option-variants").eq(0).val()},console.log(data),dataLayer.push({ecommerce:{currencyCode:"RUB",add:{products:[data]}}})})}function productOnPhoto(t){const o=tovarsFromDB.photos[getTovarId(t)];if(!o||!o.length)return;const e=[];t.find(".t-slds__main .t-slds__bgimg").each(function(){const t=$(this).data("original");for(const r in o){if(o[r].url!=t)continue;const a=o[r].naphoto_razmer||"",i=o[r].naphoto_doptext||"",s=[a,i].filter(Boolean).join(". ");if(s){const t=$('<div class="photoPlashka"></div>').text(s);$(this).append(t)}o[r].naphoto_razmer&&e.push(o[r].naphoto_razmer);break}});const r=[...new Set(e)];if(r.length){const t=$('<p class="t-typography__characteristics js-store-prod-charcs costumized"></p>');t.html("<b>на фото</b> "+r.join(", ")).prependTo($(".js-store-prod-all-charcs"))}}function productNavigateToOptionPhoto(t){const o=tovarsFromDB.photos[getTovarId(t)];o&&o.length&&t.find(".js-product-option select").on("change",function(){const e=$(this).val();let r=-1;for(const t in o)if(o[t].naphoto_doptext===e){r=t;break}-1!=r&&t.find(".t-slds__bullet").eq(r).trigger("click")})}function productFlowersSeason(t){var o=Object.keys(flowersSeasons).join("|"),e=t.find(".js-store-prod-all-text");t.find(".js-store-prod-charcs").each(function(){if($(this).text().startsWith("состав")){var t=new RegExp(`состав: с (${o})`),r=$(this).text().match(t);if(r&&!(r.length<2)){var a={"2steblya":{"пион":"если сезон пионов ("+flowersSeasons["пион"]+") закончилса, то мы поставим вместо их кросивые пивоно видные розы","георгина":"если сезон георгин ("+flowersSeasons["георгина"]+") закончилса, то мы поставим вместо их кросивые розы"},"2steblya_white":{"пион":"если сезон пионов ("+flowersSeasons["пион"]+") закончился, то мы поставим вместо них кросивые пионовидные розы","георгина":"если сезон георгин ("+flowersSeasons["георгина"]+") закончился, то мы поставим вместо них кросивые розы"},gvozdisco:{"пион":"","георгина":""},dorogobogato:{"пион":"","георгина":""},staytrueflowers:{"пион":"","георгина":""}};if(a[site][r[1]]){var i="<br><br><strong>"+a[site][r[1]]+"</strong>";e.html(e.html()+i)}}}})}function productPodpiska(t){if(tovarsFromDB[666].includes(getTovarId(t))&&185219310892!=getTovarId(t)){$data={"2steblya":"подпис очка - это цветочеки для дома. каждую недельку разные! можно зоказать себе, можно в подарок<br><br>букептеки могут приезджать с тематической карт очкой, а могут просто сами по себе красивые без всего<br><br>карточки:<ul><li>от тайнова поклонника - будут любовные записки</li><li>мем недели - картинка для увеселения</li><li>без карточки - просто цветочки пришлем</li><li>без айдентики - даже о себе нигде не напишем</li></ul>","2steblya_white":"",gvozdisco:"",dorogobogato:"",staytrueflowers:""};var o=t.find(".js-store-prod-all-text");o.html(o.html()+"<br><br>"+$data[site]);var e=t.find('.js-product-edition-option[data-edition-option-id="фор мат"] select'),r=e.find("option");$(r).each(function(t){var o=[1,0,3,2,5,4][t];$(this).insertAfter(e.children("option:eq("+o+")"))}),e.children("option:first").prop("selected",!0);var a=new Event("change");e.get(0).dispatchEvent(a)}}function productEvkalipt(t){if(tovarsFromDB.evkalipt.includes(getTovarId(t))){$data={"2steblya":"цветочики вкуснее с эвкалиптом. мы рекомен дуем:<br>1 эвкалипт к букетусикам<br>2 эвкалипта к букетикам и букетам<br>3 эвкалипта к букетищам и прочим корзинам","2steblya_white":"цветочки лучше с эвкалиптом. мы рекомендуем:<br>1 эвкалипт к маленьким букетам<br>2 эвкалипта к средним букетам<br>3 эвкалипта к большим букетам",gvozdisco:"цветочки лучше с эвкалиптом. мы рекомендуем:<br>1 эвкалипт к букетусикам<br>2 эвкалипта к букетикам и букетам<br>3 эвкалипта к букетищам и прочим корзинам",dorogobogato:"цветочки лучше с эвкалиптом. мы рекомендуем:<br>1 эвкалипт к букетусикам<br>2 эвкалипта к букетикам и букетам<br>3 эвкалипта к букетищам и прочим корзинам",staytrueflowers:""};var o=t.find(".js-store-prod-all-text");o.html((o.html().trim()?o.html()+"<br><br>":"")+$data[site]).show()}}function productMono(t){const o=getTovarId(t),e=tovarsFromDB.razdel[o];if(e&&e.includes("МОНО")&&("2steblya"!=site||![221040427501,637495188911,695336310901,247137164121].includes(o))){$data={"2steblya":"почему мы не указываем, сколько конкретно цветочков будет в букепте?<br>\n\t\t\tпушто ихний сезон только начался, цена постоянно меняется(в основном, снижаеца, в конце сезона буит расти), а мы всегда за упрощщение.<br>\n\t\t\tштоб не пересчитывать цены каждый день, мы прост буим по мере их удешевления вам их <b>побольше</b> в букептеки добавлять и все. по-чесноку, без обманки!<br>\n\t\t\tи если цвэт не принципеален, выберайте на вкус флориста - выберем <b>самый жир!</b>","2steblya_white":"",gvozdisco:"",dorogobogato:"",staytrueflowers:""};var r=t.find(".js-store-prod-all-text");r.html((r.html().trim()?r.html()+"<br><br>":"")+$data[site]).show()}}function productsToHide(t,o){tovarsFromDB.hidden.includes(getTovarId(t))&&t.prev(".t-clear").addBack().hide()}function productReplaceCardImgWithText(t,o){function e(o){o||t.find(".js-product-option:last").remove()}function r(t){var o=getTovarTitle(t);return[821562052022,434201329362].includes(getTovarId(t))&&(o="ОБОЖАБА"),o.replace(/\s[#|№]\d+$/,"")}if(tovarsFromDB.card_type_no.includes(getTovarId(t)))t.addClass("noCard");else if(tovarsFromDB.card_type_text.includes(getTovarId(t))){var a={"2steblya":"<p>«здесь может быть ваша реклама»</p><p>или какой хочешь текст,</p><p>решать тебе</p>","2steblya_white":"<p>здесь мы разместим ваше</p><p>пожелание или поздравление</p>",gvozdisco:"",dorogobogato:"",staytrueflowers:""},i=t.find(o?".t-store__card__bgimg_second":'.t-slds__item[data-slide-index="2"]'),s=$('<div class="card__container t-text"></div>'),n=['<p class="card__buket">этот букет называется</p>','<div class="card__title">'+r(t)+"</div>",'<div class="card__text">'+getTovarCardText(t)+"</div>"];"2steblya"!=site&&"2steblya_white"!=site||n.push('<div class="card__your-text">'+a[site]+"</div>"),s.append(n.join("")),i.addClass("card").html(s),o||setTimeout(function(){i.height(i.width())},500),e(o)}else e(o)}function productHideEmptyText(t){var o=t.find(".js-store-prod-all-text");o.text().trim()||o.hide()}function productVyebriKartochku(t){var o=["с нашей карточкой","со своим текстом","без карточки","без айдентики"];t.find(".js-product-option:last select").on("change",function(){var t=$(this).parents(".t-store").find(".t-slds__thumbsbullet");if(t.length)switch($(this).val()){case o[0]:t.eq(1).trigger("click");break;default:if(!t.eq(1).is(".t-slds__bullet_active"))break;t.eq(0).trigger("click")}})}function productAddAdditionalText(t){var o={"2steblya":[857613433221],"2steblya_white":[],gvozdisco:[],dorogobogato:[],staytrueflowers:[]};if(!o[site].includes(getTovarId(t))){var e={"2steblya":"к любому букету прилагается его состав и чудо-порошок для продления жизни цветов<br>к букетам с айдентикой также прилагается карт очка и сосабельный петушок","2steblya_white":'к любому букету прилагается его состав и чудо-порошок для продления жизни цветов<br>в составе могут быть <a href="/substitute" target="_blank">замены</a>',gvozdisco:'к любому букету прилагаются бесплатные <a href="/glasees">дурацкие очки</a>',dorogobogato:"",staytrueflowers:'к каждому букету прилагается карточка с его названием, состав, порошок для продления жизни цветов. и леденец для настроения :-)<br><br>ВАЖНО: про <a href="/substitute" target="_blank">замены в букетах</a>'},r=$('<div class="t-store__prod-popup__text-dop"></div>');r.html(e[site]),$(".js-store-prod-text").append(r)}}function productCharcs(t){t.find(".js-store-prod-charcs").each(function(){$(this).addClass("costumized");let[t,...o]=$(this).text().split(/:\s/);o=o.join(": "),$(this).html("<b>"+t+"</b> "+o),productRemoveCharcs($(this))})}function productRemoveCharcs(t){var o={"2steblya":["гамма","цвет","состав"],"2steblya_white":["гамма","цвет","состав"],gvozdisco:[],dorogobogato:[],staytrueflowers:[]};o[site].includes(t.children("b").text())&&t.hide()}function productLogoInHeader(){$(".js-store-close-text").empty().addClass("logo"),$(".t-popup__close").addClass("logo"),$("a.t-store__prod-popup__close-txt").attr("href","/")}function productOptionsReadMore(t){var o={"2steblya":{"фор мат":{url:"/format",text:"можна попа дробнее?"},"выебри карточку":{url:"/card",text:"а это шо такое?"}},"2steblya_white":{"формат":{url:"/format",text:"подробнее о размерах"},"карточка":{url:"/card",text:"что такое карточка?"}},gvozdisco:{"формат":{url:"/format",text:"подробнее о форматах"},"карточка":{url:"/card",text:"что такое карточка?"}},dorogobogato:{"формат":{url:"/format",text:"подробнее"},"карточка":{url:"/card",text:"подробнее"}},staytrueflowers:{"формат":{url:"/format",text:"?"},"карточка":{url:"/card",text:"?"}}};t.find(".t-product__option-select").each(function(){var t=o[site][$(this).parent().prev().text()];t&&$(this).after(`<a class="product__optionReadMore" href="${t.url}" onclick="window.open('${t.url}');return false;">${t.text}</a>`)})}function productHtmlInDescription(t){var o=t.find(".js-store-prod-all-text");if(o.length&&o.html().includes("&lt;")){var e=o.html();e=e.replace("&lt;","<"),e=e.replace("&gt;",">"),o.html(e)}}function productBlackFriday(t){}function productSoldOut(t,o){if(o){var e=t.find(".js-store-prod-sold-out");if(!e.length)return;e.removeClass("t-name").addClass("t-descr").css({"line-height":"31px","text-transform":"lowercase"}),e.siblings(".t-store__card__price").hide()}else{if(!["Нет в наличии","Out of stock"].includes($(".t-store__prod-popup__btn").text().trim()))return;notAllowed(t)}}function produnctNotAllowed(t,o){tovarsFromDB.not_allowed.includes(getTovarId(t))&&(o?t.prev(".t-clear").addBack().hide():notAllowed(t))}function notAllowed(t){t.find(".t-store__prod-popup__btn").hide().after('<div class="productSoldout t-btn">нет в наличии</div>'),t.find(".js-product-controls-wrapper").hide()}function productHideDisabledFormatOption(t){t.find('[data-edition-option-id="'+productFormat[site]+'"] option[disabled]').hide()}function getTovarCardText(t){var o=t.find(".js-product-option");if(!o.length)return"";var e=o.last().find("select").val();return e=e.replace(/\*s\*(.*?)\*s\*/g,"<s>$1</s>"),e?e.split("*br*").join("<br>"):""}function getTovarTitle(t){return t.find(".js-store-prod-name").text()}function getTovarId(t){return parseInt(t.attr("data-product-gen-uid"))}function getTovarSku(t){return t.find(".js-product-sku").text()}function getTovarPrice(t){var o=t.find("[data-product-price-def]");return o&&o.text()?parseInt(o.text().replace(/[^\d]/g,"")):null}function isVitrina(t){return!!t.parents(".uc-vitrina__catalog").length}function owlCatalog(t,o){async function e(){return await new Promise(t=>setTimeout(t,1e3)),t.find(".t-store__grid-separator").remove(),s.each(function(){var t=$(this);"vitrina"==o&&t.find(".js-store-prod-sold-out").length&&t.remove();var e=[tovarsFromDB.not_allowed.includes(getTovarId(t)),tovarsFromDB.hidden.includes(getTovarId(t)),t.is(":hidden")];e.includes(!0)&&t.remove()}),t.find(".js-store-grid-cont .js-product")}function r(){var e=1;$(window).width()>550&&e++,$(window).width()>850&&e++,e>1&&2==s.length&&t.addClass("twoItems"),t.find(".js-store-grid-cont").owlCarousel({items:s.length>e?e:s.length,margin:30,loop:"vitrina"!=o,nav:s.length>e,dots:!1})}function a(){var o=t.find(".owl-nav:not(.disabled)");o.length&&setTimeout(function(){o.show().css({top:t.find(".t-store__card__bgimg").height()/2+"px"})},1e3)}function i(){t.find(".js-product-img").each(function(){$(this).css("background-image","url("+$(this).data("original")+")")})}var s;t.addClass("uc-"+o+"__catalog").addClass("owlCatalog");var n=1e4,d=0,c=100,l=setInterval(async function(){if(d+=c,s=t.find(".js-store-grid-cont .js-product"),s.length){if(s=await e(),clearInterval(l),r(),a(),i(),"vitrina"!=o)return;$('[class*="vitrina"]').show()}d>=n&&clearInterval(l)},c)}function novinkiCatalog(t){fetch(`https://php.2steblya.ru/ajax.php?script=Tilda_products_from_DB&products=new&site=${site}`).then(t=>{if(!t.ok)throw new Error(`Ошибка сети: ${t.status} ${t.statusText}`);return t.json()}).then(t=>{if(!t.success)throw new Error("Ошибка загрузки данных");return t.fromDB.map(t=>t.id)}).then(o=>{let e=0;const r=60,a=setInterval(()=>{e++;const i=t.find(".js-product.loaded");i.length?(i.filter(function(){const t=+$(this).attr("data-product-gen-uid");return!o.includes(t)||tovarsFromDB.not_allowed.includes(t)}).remove(),t.find(".js-product.loaded").length&&(t.find(".t-store__load-more-btn-wrap").remove(),owlCatalog(t,"novinki"),t.show().prev().show()),clearInterval(a)):e>=r&&clearInterval(a)},1e3)}).catch(t=>{console.error("Ошибка при загрузке товаров:",t)})}