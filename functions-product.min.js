function product(){var t=setInterval(function(){if(tovarsFromDBReady)if(window.location.pathname.includes("/tproduct/")){productLogoInHeader();var e=$(".js-store-product:not(.loaded)");if(!e)return;if(!$(".t-slds__item-loaded").length)return;setTimeout(function(){productTovarFunctions(e)},1e3),clearInterval(t)}else{var o=$(".js-store");if(!o.length)return;o.each(function(){var t=$(this);productCatalogFunctions(t),setTimeout(function(){$.each(o,function(){var t=$(this),e=t.find(".js-store-grid-cont .js-product");e.length&&(e.each(function(){productCatalogTovarFunctions($(this),t)}),window.dispatchEvent(new Event("resize")))})},1e3)}),clearInterval(t)}},50)}function productTovarFunctions(t){productReplaceCardImgWithText(t),productVyebriKartochku(t),productOptionsReadMore(t),productHtmlInDescription(t),productHideEmptyText(t),productAddAdditionalText(t),productFlowersSeason(t),productFlowersMono(t),productPodpiska(t),productCharcs(t),productBlackFriday(t),productSoldOut(t),productButton(t),productOnPhoto(t),productCartDisabled(t),productHideDisabledFormatOption(t),productShow(t)}function productCatalogTovarFunctions(t,e){productPrices(t,e),productReplaceCardImgWithText(t,e),productBlackFriday(t),productSoldOut(t,e),productPlashka(t),productBomjPlashka(t,e),productHideVitrinaDuplicate(t,e),productsTotHide(t),productShow(t)}function productCatalogFunctions(t){productPopupOpen(t),productPopupClose(),productCatalogMenu(t),productCatalogMutationObserver(t)}function productIsPopup(){return!($("#allrecords > *").length<=4)}function productPopupOpen(t){var e=setInterval(function(){function o(t,e){t.length&&setTimeout(function(){productTovarFunctions(r)},1e3)}var r=t.find(".t-popup .js-product:not(.loaded)");if(r.length){var i=new MutationObserver(o);i.observe(r.get(0),{attributes:!0,attributeFilter:["data-product-gen-uid"],attributeOldValue:!0,childList:!1,subtree:!1}),clearInterval(e)}},50)}function productPopupClose(){$("body").on("click",".t-popup__close,.t-store__prod-popup__close-txt-wr,.t-store__prod-popup__btn",function(){var t=$(this).parents(".t-popup").find(".js-product");productHide(t)})}function productShow(t){t.addClass("loaded"),t.children().animate({opacity:1},250)}function productHide(t){t.removeClass("loaded multiplePrices bomj noCard"),setTimeout(function(){t.children().css("opacity",0)},300)}function productCatalogMenu(t){setTimeout(function(){var e=t.find(".js-store-parts-switcher");e.length},1e3)}function productCatalogMutationObserver(t){function e(e,o){if(e.length){var r=t.find(".js-store-grid-cont .js-product:not(.loaded)");r.length&&setTimeout(function(){r.each(function(){productCatalogTovarFunctions($(this),t)}),window.dispatchEvent(new Event("resize")),"function"==typeof reorderTovarsByCardWrapper&&reorderTovarsByCardWrapper()},1e3)}}var o=new MutationObserver(e);o.observe(t.children(".js-store-grid-cont").get(0),{attributes:!1,childList:!0,subtree:!1})}function productHideVitrinaDuplicate(t,e){isVitrina(e)||$.each(tovarsFromDB.vitrina,function(e,o){getTovarId(t)==o&&t.hide()})}function productPrices(t,e){function o(){tovarsFromDB.fixed_price.includes(getTovarId(t))||t.find('[data-edition-option-id="'+productFormat[site]+'"] select option').length<2||t.addClass("multiplePrices")}function r(){var e=!1;if($.each(productPriceLevels[site],function(o,r){o>=minPrice[site]||(e=!0,t.removeClass("bomj"),$.each(r,function(e,o){t.find('[data-edition-option-id="'+productFormat[site]+'"] select option[value="'+o+'"]').remove()}))}),e){var o=t.find('[data-edition-option-id="'+productFormat[site]+'"] select option').length;o||t.hide(),1==o&&t.removeClass("multiplePrices"),getTovarPrice(t)<minPrice[site]&&t.find(".js-product-price").text(minPrice[site].toString().replace(/(\d{3})$/," $1"))}}o(),isVitrina(e)||r()}function productCartDisabled(t){if(!cartEnabled[site]){var e={"2steblya":["а как купить?",'сорян, мы зашиваемся и пока прием заказов заказан. но если у вас очень важное дело, то напишите нам в <a href="https://t.me/dva_steblya" target="blank">телегу</a>, че-нить придумаем<'],gvozdisco:["А как купить?",'К сожалению, в данный момент прием заказов закрыт. но ты всегда можешь <a href="https://t.me/gvozdisco">написать нам</a>, и мы обязательно постараемся тебе помочь.'],staytrueflowers:["А как купить?",'К сожалению, в данный момент прием заказов закрыт. Но вы всегда можете <a href="https://t.me/staytrueflowers">написать нам</a>, и мы обязательно постараемся вам помочь.']},o=['<p class="t-btn">'+e[site][0]+"</p>",'<p class="t-text">'+e[site][1]+"/p>"],r=$('<div class="cartDisabled t-text"></div>');r.html(o.join("")),t.find(".js-product-controls-wrapper").hide().after(r),t.find(".js-store-buttons-wrapper").remove()}}function productPlashka(t){var e=t.find(".t-store__card__mark-wrapper");if(!e.length){var o=[],r={random_sostav:{"2steblya":"букет, чтоб не париться с выбором",staytruefloers:"состав на вкус флориста"},select_gamma:{"2steblya":"можно выбрать гамму",staytruefloers:"можно выбрать гамму"},select_color:{"2steblya":"можно выбрать цвет",staytruefloers:"можно выбрать цвет"}};for(var i in r)r.hasOwnProperty(i)&&tovarsFromDB[i].includes(getTovarId(t))&&o.push(r[i][site]);o.length&&(e=$('<div class="t-store__card__mark-wrapper"><div class="t-store__card__mark">'+o.join(", ")+"</div></div>"))}e.length&&e.appendTo(t.find(".t-store__card__bgimg"))}function productBomjPlashka(t,e){if("2steblya"==site&&!(getTovarPrice(t)>Object.keys(productPriceLevels[site])[0]||tovarsFromDB[888].includes(getTovarId(t)))){t.addClass("bomj");var o={"2steblya":"бомжетный",gvozdisco:"бюджетный",staytrueflowers:"бюджетный"},r=$('<div class="bomjPlashka">'+o[site]+"</div>");t.find(e?".js-product-img":".t-slds").append(r),e||setInterval(function(){r.toggle(!$('.t-slds__item[data-slide-index="2"]').is(".t-slds__item_active"))},100)}}function productButton(t){tovarsFromDB[1111].includes(getTovarId(t))&&$(".js-store-prod-popup-buy-btn-txt").text("ЗАДОНАТИТЬ!")}function productOnPhoto(t){function e(){var e=new XMLHttpRequest;e.open("GET",t.attr("data-product-url"),!1),e.send();var o=new DOMParser;r($(o.parseFromString(e.responseText,"text/html")).find(".t-rec:first > script"))}function o(){r(t.parents(".t-rec").children("script"))}function r(e){var o=e.text().match(/var product = (.*)\n/);if(o&&!(o.length<2||(o=JSON.parse(o[1].slice(0,-1)),o.editions.length<2))){for(var r=[],i=[],s=0;s<o.editions.length;s++){if(!o.editions[s].img)continue;const t=o.editions[s][productFormat[site]].match(/(.+?)\sх\d+\sдоставки/),e=t?t[1]:o.editions[s][productFormat[site]];i.push([e,o.editions[s].img]),r.push(o.editions[s][productFormat[site]])}if(r=r.map(t=>{var e=t.match(/(.+?)\sх\d+\sдоставки/);return e?e[1]:t}),r=[...new Set(r)],i.length){s=0;if(t.find(".t-slds__main .t-slds__bgimg").each(function(t,e){t<2||(void 0!==i[s+1]&&$(this).attr("data-original")==i[s+1][1]&&s++,$(this).append('<div class="photoPlashka">'+i[s][0]+"</div>"))}),"2steblya"==site){t.find(".t-typography__characteristics").each(function(){if("на фото"==!$(this).find("b").text())return $(this).hide(),!1});var a=$('<p class="t-typography__characteristics js-store-prod-charcs costumized"></p>');a.html("<b>на фото</b> "+r.join(", ")).prependTo(t.find(".js-store-prod-all-charcs"))}}}}productIsPopup()?e():o()}function productFlowersSeason(t){var e=Object.keys(flowersSeasons).join("|"),o=t.find(".js-store-prod-all-text");t.find(".js-store-prod-charcs").each(function(){if($(this).text().startsWith("состав")){var t=new RegExp(`состав: с (${e})`),r=$(this).text().match(t);if(r&&!(r.length<2)){var i={"2steblya":{"пион":"если сезон пионов ("+flowersSeasons["пион"]+") закончилса, то мы поставим вместо их кросивые пивоно видные розы","георгина":"если сезон георгин ("+flowersSeasons["георгина"]+") закончилса, то мы поставим вместо их кросивые розы"},gvozdisco:{"пион":"","георгина":""},staytrueflowers:{"пион":"","георгина":""}};if(i[site][r[1]]){var s="<br><br><strong>"+i[site][r[1]]+"</strong>";o.html(o.html()+s)}}}})}function productPodpiska(t){if(tovarsFromDB[666].includes(getTovarId(t))){var e=t.find('.js-product-edition-option[data-edition-option-id="фор мат"] select'),o=e.find("option");$(o).each(function(t){var o=[1,0,3,2,5,4][t];$(this).insertAfter(e.children("option:eq("+o+")"))}),e.children("option:first").prop("selected",!0);var r=new Event("change");e.get(0).dispatchEvent(r),$data={"2steblya":"подпис очка - это цветочеки для дома. каждую недельку разные! можно зоказать себе, можно в подарок<br><br>букептеки могут приезджать с тематической карт очкой, а могут просто сами по себе красивые без всего<br><br>карточки:<ul><li>от тайнова поклонника - будут любовные записки</li><li>мем недели - картинка для увеселения</li><li>без карточки - просто цветочки пришлем</li><li>без айдентики - даже о себе нигде не напишем</li></ul>",gvozdisco:"",staytrueflowers:""};var i=t.find(".js-store-prod-all-text");i.html(i.html()+"<br><br>"+$data[site])}}function productFlowersMono(t){if(tovarsFromDB.mono.includes(getTovarId(t))){$data={"2steblya":"цветочики вкуснее с эвкалиптом. мы рекомен дуем:<br>1 эвкалипт к букетусикам<br>2 эвкалипта к букетикам и букетам<br>3 эвкалипта к букетищам и прочим корзинам",gvozdisco:"цветочки лучше с эвкалиптом. мы рекомен дуем:<br>1 эвкалипт к букетусикам<br>2 эвкалипта к букетикам и букетам<br>3 эвкалипта к букетищам и прочим корзинам",staytrueflowers:""};var e=t.find(".js-store-prod-all-text");e.html(e.html()+"<br><br>"+$data[site])}}function productsTotHide(t){tovarsFromDB.hidden.includes(getTovarId(t))&&t.prev(".t-clear").addBack().hide()}function productReplaceCardImgWithText(t,e){function o(e){e||t.find(".js-product-option:last").remove()}if(tovarsFromDB.card_type_no.includes(getTovarId(t)))t.addClass("noCard");else if(tovarsFromDB.card_type_text.includes(getTovarId(t))){var r={"2steblya":"<p>«здесь может быть ваша реклама»</p><p>или какой хочешь текст,</p><p>решать тебе</p>",gvozdisco:"<p>здесь мы разместим твое пожелание или поздравление</p>",staytrueflowers:"<p>здесь мы разместим ваше пожелание или поздравление</p>"},i=t.find(e?".t-store__card__bgimg_second":'.t-slds__item[data-slide-index="2"]'),s=$('<div class="card__container t-text"></div>'),a=['<p class="card__buket">этот букет называется</p>','<div class="card__title">'+getTovarTitle(t)+"</div>",'<div class="card__text">'+getTovarCardText(t)+"</div>"];"2steblya"==site&&a.push('<div class="card__your-text">'+r[site]+"</div>"),s.append(a.join("")),i.addClass("card").html(s),e||setTimeout(function(){i.height(i.width())},500),o(e)}else o(e)}function productHideEmptyText(t){var e=t.find(".js-store-prod-all-text");e.text().trim()||e.hide()}function productVyebriKartochku(t){var e=["с нашей карточкой","со своим текстом","без карточки","без айдентики"];t.find(".js-product-option:last select").on("change",function(){var t=$(this).parents(".t-store").find(".t-slds__thumbsbullet");if(t.length)switch($(this).val()){case e[0]:t.eq(1).trigger("click");break;default:if(!t.eq(1).is(".t-slds__bullet_active"))break;t.eq(0).trigger("click")}})}function productAddAdditionalText(t){var e={"2steblya":[857613433221],gvozdisco:[],staytrueflowers:[]};if(!e[site].includes(getTovarId(t))){var o={"2steblya":"к любому букету прилагается его состав и чудо-порошок для продления жизни цветов<br>к букетам с айдентикой также прилагается карт очка и сосабельный петушок",gvozdisco:"к любому букету прилагается его состав и чудо-порошок для продления жизни цветов<br>к букетам с айдентикой также прилагается карточка и очечи",staytrueflowers:'к каждому букету прилагается карточка с его названием, состав, порошок для продления жизни цветов. и леденец для настроения :-)<br><br>ВАЖНО: про <a href="/substitute" target="_blank">замены в букетах</a>'},r=$('<div class="t-store__prod-popup__text-dop"></div>');r.html(o[site]),$(".js-store-prod-text").append(r)}}function productCharcs(t){t.find(".js-store-prod-charcs").each(function(){$(this).addClass("costumized");let[t,...e]=$(this).text().split(/:\s/);e=e.join(": "),$(this).html("<b>"+t+"</b> "+e),productRemoveCharcs($(this))})}function productRemoveCharcs(t){var e={"2steblya":["гамма","цвет","состав"],gvozdisco:[],staytrueflowers:[]};e[site].includes(t.children("b").text())&&t.hide()}function productLogoInHeader(){$(".js-store-close-text").empty().addClass("logo"),$(".t-popup__close").addClass("logo"),$("a.t-store__prod-popup__close-txt").attr("href","/")}function productOptionsReadMore(t){var e={"2steblya":{"фор мат":"/format","выебри карточку":"/card"},gvozdisco:{"формат":"/format","карточка":"/card"},staytrueflowers:{"формат":"/format","карточка":"/card"}};t.find(".t-product__option-select").each(function(){var t=e[site][$(this).parent().prev().text()];t&&$(this).after('<a class="product__optionReadMore" href="'+t+'" onclick="window.open(\''+t+"');return false;\">?</a>")})}function productHtmlInDescription(t){var e=t.find(".js-store-prod-all-text");if(e.length&&e.html().includes("&lt;")){var o=e.html();o=o.replace("&lt;","<"),o=o.replace("&gt;",">"),e.html(o)}}function productBlackFriday(t){}function productSoldOut(t,e){if(e){var o=t.find(".js-store-prod-sold-out");o.removeClass("t-name").addClass("t-descr").css({"line-height":"31px","text-transform":"lowercase"}),o.siblings(".t-store__card__price").hide()}else{var r=$(".t-store__prod-popup__btn");r.show();var i=$(".js-product-controls-wrapper");if(i.show(),t.find(".productSoldout").remove(),!["Нет в наличии","Out of stock"].includes(r.text().trim()))return;r.hide().after('<div class="productSoldout t-btn">нет в наличии</div>'),i.hide()}}function productHideDisabledFormatOption(t){t.find('[data-edition-option-id="'+productFormat[site]+'"] option[disabled]').hide()}function getTovarCardText(t){var e=t.find(".js-product-option");if(!e.length)return"";var o=e.last().find("select").val();return o=o.replace(/\*s\*(.*?)\*s\*/g,"<s>$1</s>"),o?o.split("*br*").join("<br>"):""}function getTovarTitle(t){return t.find(".js-store-prod-name").text()}function getTovarId(t){return parseInt(t.attr("data-product-gen-uid"))}function getTovarPrice(t){var e=t.find("[data-product-price-def]");return e&&e.text()?parseInt(e.text().replace(/[^\d]/g,"")):null}function isVitrina(t){return!!t.parents(".uc-vitrina__catalog").length}function owlCatalog(t,e){function o(){return t.find(".t-store__grid-separator").remove(),"vitrina"==e&&a.each(function(){var t=$(this);t.find(".js-store-prod-sold-out").length&&t.remove()}),t.find(".js-store-grid-cont .js-product")}function r(){var o=1;$(window).width()>550&&o++,$(window).width()>850&&o++,o>1&&2==a.length&&t.addClass("twoItems"),t.find(".js-store-grid-cont").owlCarousel({items:a.length>o?o:a.length,margin:30,loop:"vitrina"!=e,nav:a.length>o,dots:!1})}function i(){var e=t.find(".owl-nav:not(.disabled)");e.length&&setTimeout(function(){e.show().css({top:t.find(".t-store__card__bgimg").height()/2+"px"})},1e3)}function s(){t.find(".js-product-img").each(function(){$(this).css("background-image","url("+$(this).data("original")+")")})}var a;t.addClass("uc-"+e+"__catalog").addClass("owlCatalog");var n=1e4,d=0,c=100,l=setInterval(function(){if(d+=c,a=t.find(".js-store-grid-cont .js-product"),a.length){if(a=o(),!a.length)return;if(clearInterval(l),r(),i(),s(),"vitrina"!=e)return;$('[class*="vitrina"]').show()}d>=n&&clearInterval(l)},c)}function newCatalog(t){$tovarsFromDbPromise=new Promise((t,e)=>{$.ajax({url:"https://php.2steblya.ru/ajax.php?script=Tilda_products_from_DB&products=new&site="+site,crossDomain:!0,type:"GET",success:function(o){o=JSON.parse(o),o.success?t(o.fromDB):e()},error:function(t){e(t)}})}),$tovarsFromDbPromise.then(e=>{var o=setInterval(function(){var r=t.find(".js-product.loaded");if(r.length){clearInterval(o);var i=r.parent(),s={};r.each(function(){s[$(this).attr("data-product-gen-uid")]=$(this).clone()}),i.empty();for(var a=0;a<e.length&&15!=a;a++)s[e[a].id]&&i.append(s[e[a].id]);t.find(".t-store__load-more-btn-wrap").remove(),owlCatalog(t,"new")}},100)}).catch(t=>{console.error("Error fetching data:",t)})}