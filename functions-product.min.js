function product(){var t=setInterval(function(){if(window.location.pathname.includes("/tproduct/")){productLogoInHeader();var e=$(".js-store-product:not(.loaded)");if(!e)return;if(!$(".t-slds__item-loaded").length)return;setTimeout(function(){productTovarFunctions(e)},1e3),clearInterval(t)}else{var o=$(".js-store");if(!o.length)return;o.each(function(){productCatalogFunctions($(this))}),clearInterval(t)}},50)}function productTovarFunctions(t){productReplaceCardImgWithText(t),productVyebriKartochku(t),productOptionsReadMore(t),productHtmlInDescription(t),productHideEmptyText(t),productAddAdditionalText(t),productFlowersSeason(t),productCharcs(t),productBlackFriday(t),productSoldOut(t),productButton(t),productOnPhoto(t),productCartDisabled(t),productShow(t)}function productCatalogTovarFunctions(t,e){productPrices(t,e),productReplaceCardImgWithText(t,e),productBlackFriday(t),productSoldOut(t,e),productPlashka(t),productBomjPlashka(t,e),productHideVitrinaDuplicate(t,e),productsTotHide(t),productShow(t)}function productCatalogFunctions(t){isVitrina(t,!0)||(productPopupOpen(t),productPopupClose(),productCatalogMenu(t),productCatalogMutationObserver(t))}function productIsPopup(){return!($("#allrecords > *").length<=4)}function productPopupOpen(t){var e=setInterval(function(){function o(t,e){t.length&&setTimeout(function(){productTovarFunctions(r)},1e3)}var r=t.find(".t-popup .js-product:not(.loaded)");if(r.length){var i=new MutationObserver(o);i.observe(r.get(0),{attributes:!0,attributeFilter:["data-product-gen-uid"],attributeOldValue:!0,childList:!1,subtree:!1}),clearInterval(e)}},50)}function productPopupClose(){$("body").on("click",".t-popup__close,.t-store__prod-popup__close-txt-wr,.t-store__prod-popup__btn",function(){var t=$(this).parents(".t-popup").find(".js-product");productHide(t)})}function productShow(t){t.addClass("loaded"),t.children().animate({opacity:1},250)}function productHide(t){t.removeClass("loaded multiplePrices bomj noCard"),setTimeout(function(){t.children().css("opacity",0)},300)}function productCatalogMenu(t){setTimeout(function(){var e=t.find(".js-store-parts-switcher");e.length},1e3)}function productCatalogMutationObserver(t){function e(e,o){if(e.length){var r=t.find(".js-store-grid-cont .js-product:not(.loaded)");r.length&&setTimeout(function(){r.each(function(){productCatalogTovarFunctions($(this),t)}),window.dispatchEvent(new Event("resize")),"function"==typeof reorderTovarsByCardWrapper&&reorderTovarsByCardWrapper()},1e3)}}var o=new MutationObserver(e);o.observe(t.children(".js-store-grid-cont").get(0),{attributes:!1,childList:!0,subtree:!1})}function productHideVitrinaDuplicate(t,e){if(!isVitrina(e)){var o=getVitrinaTovarsIds();o.length&&$.each(o,function(e,o){getTovarId(t)==o&&t.hide()})}}function productPrices(t,e){function o(){s=t.find('[data-edition-option-id="'+productFormat[site]+'"] select option'),s.length<2||t.addClass("multiplePrices")}function r(){var e={"2steblya":[857613433221,373328609241],staytrueflowers:[]};e[site].includes(getTovarId(t))&&t.addClass("multiplePrices")}function i(){var e=!1;if($.each(productPriceLevels[site],function(o,r){o>=minPrice[site]||(e=!0,t.removeClass("bomj"),$.each(r,function(e,o){t.find('[data-edition-option-id="'+productFormat[site]+'"] select option[value="'+o+'"]').remove()}))}),e){var o=t.find('[data-edition-option-id="'+productFormat[site]+'"] select option').length;o||t.hide(),1==o&&t.removeClass("multiplePrices"),getTovarPrice(t)<minPrice[site]&&t.find(".js-product-price").text(minPrice[site].toString().replace(/(\d{3})$/," $1"))}}var s;o(),isVitrina(e)||(r(),i())}function productCartDisabled(t){if(!cartEnabled[site]){var e={"2steblya":["а как купить?",'сорян, мы зашиваемся и пока прием заказов заказан. но если у вас очень важное дело, то напишите нам в <a href="https://t.me/dva_steblya" target="blank">телегу</a>, че-нить придумаем<'],staytrueflowers:["А как купить?",'К сожалению, в данный момент прием заказов закрыт. Но вы всегда можете <a href="https://t.me/staytrueflowers">написать нам</a>, и мы обязательно постараемся вам помочь.']},o=['<p class="t-btn">'+e[site][0]+"</p>",'<p class="t-text">'+e[site][1]+"/p>"],r=$('<div class="cartDisabled t-text"></div>');r.html(o.join("")),t.find(".js-product-controls-wrapper").hide().after(r),t.find(".js-store-buttons-wrapper").remove()}}function productPlashka(t){t.find(".t-store__card__mark-wrapper").appendTo(t.find(".t-store__card__bgimg"))}function productBomjPlashka(t,e){if("2steblya"==site&&!(getTovarPrice(t)>Object.keys(productPriceLevels[site])[0])){t.addClass("bomj");var o={"2steblya":"бомжетный",staytrueflowers:"бюджетный"},r=$('<div class="bomjPlashka">'+o[site]+"</div>");t.find(e?".js-product-img":".t-slds").append(r),e||setInterval(function(){r.toggle(!$('.t-slds__item[data-slide-index="2"]').is(".t-slds__item_active"))},100)}}function productButton(t){"2steblya"==site&&857613433221==getTovarId(t)&&$(".js-store-prod-popup-buy-btn-txt").text("ЗАДОНАТИТЬ!")}function productOnPhoto(t){function e(){var e=new XMLHttpRequest;e.open("GET",t.attr("data-product-url"),!1),e.send();var o=new DOMParser;r($(o.parseFromString(e.responseText,"text/html")).find(".t-rec:first > script"))}function o(){r(t.parents(".t-rec").children("script"))}function r(e){var o=e.text().match(/var product = (.*)\n/);if(o&&!(o.length<2||(o=JSON.parse(o[1].slice(0,-1)),o.editions.length<2))){for(var r=[],i={"2steblya":"фор мат",staytrueflowers:"формат"},s=[],a=0;a<o.editions.length;a++)o.editions[a].img&&(s.push([o.editions[a][i[site]],o.editions[a].img]),r.push(o.editions[a][i[site]]));if(s.length){a=0;if(t.find(".t-slds__main .t-slds__bgimg").each(function(t,e){t<2||(void 0!==s[a+1]&&$(this).attr("data-original")==s[a+1][1]&&a++,$(this).append('<div class="photoPlashka">'+s[a][0]+"</div>"))}),"2steblya"==site){t.find(".t-typography__characteristics").each(function(){if("на фото"!=!$(this).find("b").text())return $(this).remove(),!1});var n=$('<p class="t-typography__characteristics js-store-prod-charcs costumized"></p>');n.html("<b>на фото</b> "+r.join(", ")).prependTo(t.find(".js-store-prod-all-charcs"))}}}}productIsPopup()?e():o()}function productFlowersSeason(t){var e=Object.keys(flowersSeasons).join("|"),o=t.find(".js-store-prod-all-text");t.find(".js-store-prod-charcs").each(function(){if($(this).text().startsWith("состав")){var t=new RegExp(`состав: с (${e})`),r=$(this).text().match(t);if(r&&!(r.length<2)){var i={"2steblya":{"пион":"если сезон пионов ("+flowersSeasons["пион"]+") закончилса, то мы поставим вместо их кросивые пивоно видные розы","георгина":"если сезон георгин ("+flowersSeasons["георгина"]+") закончилса, то мы поставим вместо их кросивые розы"},staytrueflowers:{"пион":"","георгина":""}};if(i[site][r[1]]){var s="<br><br><strong>"+i[site][r[1]]+"</strong>";o.html(o.html()+s)}}}})}function productsTotHide(t){var e={"2steblya":[105671635591,618173603491],staytrueflowers:[400814140661,796318578141]};e[site].includes(getTovarId(t))&&t.prev(".t-clear").addBack().hide()}function productReplaceCardImgWithText(t,e){function o(){getTovarCardText(t)||(t.find(".js-product-option").find('select option[value="с нашей карточкой"]').remove(),t.find('[data-slide-bullet-for="2"]').remove(),t.addClass("noCard"))}function r(e){e||t.find(".js-product-option:last").remove()}function i(t){var e={"2steblya":[],staytrueflowers:[]};return e["2steblya"].push(896292515801),e["2steblya"].push(103878497051),e["2steblya"].push(448865187471),e["2steblya"].push(260954710551),e["2steblya"].push(953890300331),!e[site].includes(getTovarId(t))}if(!i(t))return o(),void r(e);var s={"2steblya":"<p>«здесь может быть ваша реклама»</p><p>или какой хочешь текст,</p><p>решать тебе</p>",staytrueflowers:"<p>здесь мы разместим ваше пожелание или поздравление</p>"},a=t.find(e?".t-store__card__bgimg_second":'.t-slds__item[data-slide-index="2"]'),n=$('<div class="card__container t-text"></div>'),d=['<p class="card__buket">этот букет называется</p>','<div class="card__title">'+getTovarTitle(t)+"</div>",'<div class="card__text">'+getTovarCardText(t)+"</div>"];"2steblya"==site&&d.push('<div class="card__your-text">'+s[site]+"</div>"),n.append(d.join("")),a.addClass("card").html(n),e||setTimeout(function(){a.height(a.width())},500),o(),r(e)}function productHideEmptyText(t){var e=t.find(".js-store-prod-all-text");e.text().trim()||e.hide()}function productVyebriKartochku(t){var e=["с нашей карточкой","со своим текстом","без карточки","без айдентики"];t.find(".js-product-option:last select").on("change",function(){var t=$(this).parents(".t-store").find(".t-slds__thumbsbullet");if(t.length)switch($(this).val()){case e[0]:t.eq(1).trigger("click");break;default:if(!t.eq(1).is(".t-slds__bullet_active"))break;t.eq(0).trigger("click")}})}function productAddAdditionalText(t){var e={"2steblya":[857613433221],staytrueflowers:[]};if(!e[site].includes(getTovarId(t))){var o={"2steblya":"к любому букету прилагается его состав и чудо-порошок для продления жизни цветов<br>к букетам с айдентикой также прилагается карт очка и сосабельный петушок",staytrueflowers:'к каждому букету прилагается карточка с его названием, состав, порошок для продления жизни цветов. и леденец для настроения :-)<br><br>ВАЖНО: про <a href="/substitute" target="_blank">замены в букетах</a>'},r=$('<div class="t-store__prod-popup__text-dop"></div>');r.html(o[site]),$(".js-store-prod-text").append(r)}}function productCharcs(t){t.find(".js-store-prod-charcs").each(function(){$(this).addClass("costumized");let[t,...e]=$(this).text().split(/:\s/);e=e.join(": "),$(this).html("<b>"+t+"</b> "+e),productRemoveCharcs($(this))})}function productRemoveCharcs(t){var e={"2steblya":["гамма","цвет","состав"],staytrueflowers:[]};e[site].includes(t.children("b").text())&&t.remove()}function productLogoInHeader(){$(".js-store-close-text").empty().addClass("logo"),$(".t-popup__close").addClass("logo"),$("a.t-store__prod-popup__close-txt").attr("href","/")}function productOptionsReadMore(t){var e={"2steblya":{"фор мат":"/format","выебри карточку":"/card"},staytrueflowers:{"формат":"/format","карточка":"/card"}};t.find(".t-product__option-select").each(function(){var t=e[site][$(this).parent().prev().text()];t&&$(this).after('<a class="product__optionReadMore" href="'+t+'" onclick="window.open(\''+t+"');return false;\">?</a>")})}function productHtmlInDescription(t){var e=t.find(".js-store-prod-all-text");if(e.length&&e.html().includes("&lt;")){var o=e.html();o=o.replace("&lt;","<"),o=o.replace("&gt;",">"),e.html(o)}}function productBlackFriday(t){}function productSoldOut(t,e){if(e){var o=t.find(".js-store-prod-sold-out");o.removeClass("t-name").addClass("t-descr").css({"line-height":"31px","text-transform":"lowercase"}),o.siblings(".t-store__card__price").hide()}else{var r=$(".t-store__prod-popup__btn");r.show();var i=$(".js-product-controls-wrapper");if(i.show(),t.find(".productSoldout").remove(),!["Нет в наличии","Out of stock"].includes(r.text().trim()))return;r.hide().after('<div class="productSoldout t-btn">нет в наличии</div>'),i.hide()}}function getTovarCardText(t){var e=t.find(".js-product-option:last").find("select").val();return e?e.split("*br*").join("<br>"):""}function getTovarTitle(t){return t.find(".js-store-prod-name").text()}function getTovarId(t){return parseInt(t.attr("data-product-gen-uid"))}function getTovarPrice(t){var e=t.find("[data-product-price-def]");return e&&e.text()?parseInt(e.text().replace(/[^\d]/g,"")):null}function getVitrinaTovarsIds(){var t=[],e=$(".uc-vitrinaFooter .js-product.t-store__card");return e.length?(e.each(function(){t.push(getTovarId($(this)))}),t):t}function isVitrina(t,e=!1){var o=".uc-"+(e?"vitrinaFooter":"vitrina__catalog");return!!t.parents(o).length}function owlVitrina(t){function e(){t.show(),a=!0,owlNavButtons(i),owlLazyLoadChanged(i)}function o(){owlRemoveSeparators(i),s.each(function(){var t=$(this);t.find(".js-store-prod-sold-out").length&&(t.remove(),n--)})}function r(){var t=1;$(window).width()>550&&t++,$(window).width()>850&&t++,2==t&&i.addClass("twoItems"),i.find(".js-store-grid-cont").owlCarousel({items:n>t?t:n,margin:30,loop:!1,nav:n>t,dots:!1})}var i,s,a=!1,n=0;setInterval(function(){if(!a){getVitrinaTovarsIds();i=$(".uc-vitrina__catalog"),i.length&&(s=i.find(".js-store-grid-cont .js-product"),n=s.length,n&&(o(),n&&(r(),e())))}},2e3)}function owlRemoveSeparators(t){t.find(".t-store__grid-separator").remove()}function owlNavButtons(t){var e=t.find(".owl-nav:not(.disabled)");e.length&&t.find(".owl-nav").css({top:t.find(".t-store__card__bgimg").height()/2+"px"})}function owlLazyLoadChanged(t){t.find(".js-product-img").each(function(){$(this).css("background-image","url("+$(this).data("original")+")")})}