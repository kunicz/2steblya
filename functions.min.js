function redirectHome(){var r={"2steblya":["page28196964"],staytrueflowers:[]};$.each(r[site],function(r,t){document.location.href.indexOf(t)>-1&&(document.location.href="/")})}function buyToday(){var r=new URLSearchParams(window.location.search);r.has("buytoday")&&Cookies.set("buytoday",r.get("buytoday"))}function formValidationTexts(r,t=[]){r.length&&r.find(".t-submit").on("click",function(){var e={"2steblya":"укажи по брацки",staytrueflowers:"данное поле должно быть заполнено"},a=setInterval(function(){var o=r.find('[data-tilda-req="1"]').parents(".t-input-block").find(".t-input-error");o.length&&(o.each(function(r,a){var i=t[r]?t[r]:e[site];o.eq(r).text(i)}),clearInterval(a))},1)})}function headerMenu(){function r(){"2steblya"==site&&o.find(".t-sociallinks .t-sociallinks__item:last a").contents().wrapAll("<div>").parent().unwrap()}function t(){window.location.pathname&&"/"!=window.location.pathname&&o.find("a").each(function(){var r=$(this).attr("href");if("#"==Array.from(r)[0]){if("#opensearch"==r)return;$(this).attr("href","/"+r)}})}function e(){o.find('.t-menu__link-item[href*="#"]').on("click",function(){$(".tmenu-mobile").trigger("click")})}var a={"2steblya":"rec469639590",staytrueflowers:"rec496423452,#rec496387058"},o=$("#"+a[site]);o.length&&(r(),t(),e())}function spoilers(){$(".t668__title").removeClass("t-name").addClass("t-descr")}function externalLinks(){$("a").each(function(){$(this).is('[href^="htt"]:not([href*="'+window.location.hostname+'"])')&&$(this).attr("target","_blank")})}function footer(){function r(){var r={"2steblya":null,staytrueflowers:2021};if(r[site]){var t=$('.uc-footerCopyright [field="text"]'),e=(new Date).getFullYear();t.text(t.text().replace(r[site],r[site]+"-"+e))}}r()}function getFromDB(r,t){$.ajax({url:"https://php.2steblya.ru/ajax.php?script="+r,crossDomain:!0,type:"GET",success:function(r){var e=r.slice(0,1);t("{"==e||"["==e?JSON.parse(r):r)}})}function arrayOfValuesFromDB(r,t){if(!Array.isArray(r))return r;var e=[];return $.each(r,function(r,a){var o=a[t];["card_type"].includes(t)||(o=parseInt(o)),e.push(o)}),e}function getTovarsFromDBPromise(){var r=[],t={id:["hidden","dopnik","paid_delivery","allowed_today","fixed_price"],idValue:["hours_to_produce","date_to_open","days_to_close"],card_type:["no","text","image"]};return t.id.forEach(t=>{r.push(getFromDBPromise("TildaTovarsFromDB&tovars="+t+"&site="+site).then(r=>{tovarsFromDB[t]=arrayOfValuesFromDB(r,"id")}))}),r.push(getFromDBPromise("TildaTovarsFromDB&tovars=vitrina_id&site="+site).then(r=>{tovarsFromDB.vitrina=[],tovarsFromDB.vitrina_parents={},Array.isArray(r)&&r.forEach(r=>{if(r.vitrina_id.includes(",")){var t=r.vitrina_id.split(",");tovarsFromDB.vitrina.push(...t.map(r=>parseInt(r))),t.forEach(t=>{tovarsFromDB.vitrina_parents[parseInt(t)]=parseInt(r.id)})}else tovarsFromDB.vitrina.push(parseInt(r.vitrina_id)),tovarsFromDB.vitrina_parents[parseInt(r.vitrina_id)]=parseInt(r.id)})})),t.card_type.forEach(t=>{r.push(getFromDBPromise("TildaTovarsFromDB&tovars=card_type&card_type="+t+"&site="+site).then(r=>{tovarsFromDB["card_type_"+t]=arrayOfValuesFromDB(r,"id")}))}),t.idValue.forEach(t=>{r.push(getFromDBPromise("TildaTovarsFromDB&tovars="+t+"&site="+site).then(r=>{Array.isArray(r)&&(tovarsFromDB[t]={},r.forEach(r=>{var e=r[t];"date_to_open"!=t&&(e=parseInt(e)),tovarsFromDB[t][r.id]=e}))}))}),Promise.all(r).then(()=>afterGetFromDB())}function getFromDBPromise(r){return new Promise((t,e)=>{getFromDB(r,r=>{t(r)})})}function afterGetFromDB(){return new Promise((r,t)=>{var e=["fixed_price","card_type_no","card_type_text","card_type_image"];for(var a in tovarsFromDB.vitrina_parents)e.forEach(r=>{tovarsFromDB[r].includes(tovarsFromDB.vitrina_parents[a])&&tovarsFromDB[r].push(parseInt(a))});r()})}function isTovarsFromDBEmpty(r){return void 0===tovarsFromDB[r]||(!(!Array.isArray(tovarsFromDB[r])||tovarsFromDB[r].length)||"object"==typeof tovarsFromDB[r]&&!Object.keys(tovarsFromDB[r]).length)}function getRussianDaysWord(r){if("number"!=typeof r||isNaN(r))return"дней";r=Math.abs(r);var t=r%10;return 0===t||t>=5&&t<=9||r>=11&&r<=19?"дней":1===t?"день":t>=2&&t<=4?"дня":"Error"}$(document).ready(function(){redirectHome(),headerMenu(),buyToday(),externalLinks(),product(),cart(),spoilers(),footer()}),getTovarsFromDBPromise().then(()=>{tovarsFromDBReady=!0,console.log(tovarsFromDB)}).catch(r=>{console.error("Error:",r)});